[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Delivery Note",
  "enabled": 0,
  "modified": "2024-02-09 10:31:04.501976",
  "module": null,
  "name": "Guia de Remessa - incluindo opção de botão dentro do botão \"Status\"",
  "script": "frappe.ui.form.on('Delivery Note', {\n    refresh(frm) {\n    setTimeout(() => {\n        frm.remove_custom_button('Close', 'Status');\n        frm.add_custom_button('Em Espera', 'Status');\n        }, 210);\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2024-07-03 14:56:02.012665",
  "module": null,
  "name": "Confirmação se campo for vazio - Fatura de Venda",
  "script": "frappe.ui.form.on('Sales Invoice', {\n    \n     validate: async (frm) => {\n         if (frm.doc.confirmacao_do_cliente === 'SIM' && (!frm.doc.tipo || !frm.doc.confirmacao)) {\n         \n        let prompt = new Promise((resolve, reject) => {\n            \n            frappe.confirm(\n                \"A confirmação do cliente está definida como 'SIM', porém os campos relacionados de 'Tipo' ou de 'Confirmação' estão sem informação. Deseja continuar com a fatura?\",\n                () => resolve(),\n                () => reject()\n            );\n        });\n        await prompt.then(\n            () => frappe.show_alert(\"Confirmado\", 3), \n            () => {\n                frappe.validated = false;\n                frappe.show_alert(\"Não Confirmado\", 3)\n            }\n        );\n         }\n        \n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2024-04-23 09:34:22.384726",
  "module": null,
  "name": "Mensagem de alerta obter itens Fatura de Venda",
  "script": "frappe.ui.form.on('Sales Invoice', {\n    onload: function(frm) {\n        // Verifica se o campo \"faturamento_parcial\" é \"NÃO\"\n        if (frm.doc.faturamento_parcial === 'NÃO') {\n            // Exibe uma mensagem de alerta\n            frappe.msgprint({\n                title: __('Aviso de Faturamento Parcial'),\n                message: __('Este cliente não permite faturamento parcial. Certifique-se de obter os itens das Guias de Remessas vinculadas antes de criar a fatura de vendas.'),\n                \n             \n            });\n        }\n    }\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Bank Account",
  "enabled": 1,
  "modified": "2024-01-15 16:05:17.610628",
  "module": null,
  "name": "incluindo Máscara nas informações de pix dentro de Conta Bancária",
  "script": "frappe.ui.form.on('Bank Account', {\n   onload: function(frm) {\n        (async () => {\n            const response = await fetch(\"https://unpkg.com/imask\");\n            const scriptText = await response.text();\n            const script = document.createElement(\"script\");\n            script.text = scriptText;\n            document.head.appendChild(script);\n            const numeroDocumentoCPF_PIX = frm.fields_dict['cpf_pix'].$input[0];\n            const numeroDocumentoCNPJ_PIX = frm.fields_dict['cnpj_pix'].$input[0];\n            const numeroDocumentoCelular_PIX = frm.fields_dict['celular'].$input[0];\n            let mask = null;\n            numeroDocumentoCPF_PIX.setAttribute(\"maxlength\", 14);\n            mask = IMask(numeroDocumentoCPF_PIX, {\n                mask: '000.000.000-00'\n            });\n            numeroDocumentoCNPJ_PIX.setAttribute(\"maxlength\", 18);\n            mask = IMask(numeroDocumentoCNPJ_PIX, {\n                mask: '00.000.000/0000-00'\n            });\n            numeroDocumentoCelular_PIX.setAttribute(\"maxlength\", 15);\n            mask = IMask(numeroDocumentoCelular_PIX, {\n                mask: '(00) 00000-0000'\n            });\n           \n        })();\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2024-03-14 16:30:05.771287",
  "module": null,
  "name": "Verificando se Sales Order possui um orçamento aprovado antes de criar",
  "script": "frappe.ui.form.on('Sales Order', {\n    validate: async (frm) => {\n        frappe.call({\n            method: \"frappe.client.get_value\",\n            args: {\n                doctype: \"Quotation\",\n                filters: { name: frm.doc.quotation_name },\n                fieldname: \"workflow_state\"\n            },\n            callback: function(response) {\n                if (response.message && response.message.workflow_state) {\n                    let status = response.message.workflow_state;\n                    if(status !== \"Aprovado\") {\n                        frappe.msgprint(\n                        'Você só pode criar esse pedido de venda se o orçamento estiver aprovado. Por favor, verifique seu orçamento.',\n                        'Erro',\n                        function(){\n                            window.close();\n                        },\n                        \n                    )\n                        frappe.validated = false; // Impede que o formulário seja salvo\n                    }\n                } else {\n                    console.log(\"Workflow State não encontrado.\");\n                }\n            }\n        });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Payment Terms Template",
  "enabled": 1,
  "modified": "2023-01-12 13:30:12.371431",
  "module": null,
  "name": "Modelo de Termos de Pagamento",
  "script": "frappe.ui.form.on(\"Payment Terms Template\", {\n    validate(frm){\n        frm.set_value(\"allocate_payment_based_on_payment_terms\", 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2023-02-15 08:07:43.794080",
  "module": null,
  "name": "Atualização de Status automático do Pedido de Venda para fechado",
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\n  on_submit: function(frm) {\n    console.log(\"frm.doc.reference_name: \" + frm.doc.reference_name);\n    // Recupera o valor total da fatura de venda\n    var invoice_total = frm.doc.base_total;\n\n    // Recupera o valor total do pedido de venda correspondente\n    var orders = frappe.db.get_list(\"Sales Order\", { filters: { reference_name: frm.doc.reference_name } });\n\n    var order_total = 0;\n    if (orders.length > 0) {\n      order_total = orders[0].base_total;\n    }\n\n    console.log(\"order_total: \" + order_total);\n    // Compare os valores para ver se eles são iguais\n    if (invoice_total === order_total) {\n      // Se os valores forem iguais, use a função frappe.set_value para definir o estado do pedido como concluído\n      frappe.model.set_value(\"Sales Order\", frm.doc.reference_name, \"status\", \"Closed\");\n      frappe.model.set_value(\"Sales Order\", frm.doc.reference_name, \"per_delivered\", 100);\n    }\n  }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2023-01-26 14:19:27.985436",
  "module": null,
  "name": "CNPJ",
  "script": "frappe.ui.form.on('Customer', {\n    onload: function(frm) {\n        (async () => {\n            const response = await fetch(\"https://unpkg.com/imask\");\n            const scriptText = await response.text();\n            const script = document.createElement(\"script\");\n            script.text = scriptText;\n            document.head.appendChild(script);\n            const tipoDocumento = frm.fields_dict['cnpj_cpf'].$input[0];\n            const numeroDocumento = frm.fields_dict['cnpj'].$input[0];\n            let mask = null;\n            numeroDocumento.setAttribute(\"maxlength\", 18);\n            mask = IMask(numeroDocumento, {\n                mask: '00.000.000/0000-00'\n            });\n            tipoDocumento.addEventListener(\"change\", function() {\n                if (mask) {\n                    mask.destroy();\n                }\n                if (this.value === \"CPF\") {\n                    numeroDocumento.value = \"\";\n                    numeroDocumento.setAttribute(\"maxlength\", 14);\n                    mask = IMask(numeroDocumento, {\n                        mask: '000.000.000-00'\n                    });\n                } else if (this.value === \"CNPJ\") {\n                    numeroDocumento.value = \"\";\n                    numeroDocumento.setAttribute(\"maxlength\", 18);\n                    mask = IMask(numeroDocumento, {\n                        mask: '00.000.000/0000-00'\n                    });\n                }\n            });\n        })();\n    }\n});\n\nfrappe.ui.form.on(\"Customer\", \"cnpj\", function(frm) {\n    frappe.call({\n        method: 'ordem_servico.api.get_cnpj',\n        args: {\n            'cnpj': frm.doc.cnpj,\n        },\n        callback: function(r) {\n            // code snippet\n            debugger;\n            Object.keys(r.message).forEach(key => frm.set_value(key, r.message[key]));\n        }\n    });\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2022-12-20 09:30:50.738687",
  "module": null,
  "name": "Quotation images",
  "script": "frappe.ui.form.on(\"Quotation\", {\n    validate(frm){\n\tif (frm.doc.defeito_constatado && frm.doc.defeito_constatado.length){\n         frm.set_value(\"defeito_constatado\", frm.doc.defeito_constatado.replaceAll(\"img src=\", 'img style=\"max-width:150px; max-height:150px; width: auto; height: auto;\" src='));\n    }\n}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2023-09-04 10:33:20.996850",
  "module": null,
  "name": "Update Stock",
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\n    validate(frm){\n        frm.set_value(\"update_stock\", 1);\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Address",
  "enabled": 1,
  "modified": "2022-12-20 09:30:39.227439",
  "module": null,
  "name": "CEP",
  "script": "frappe.ui.form.on(\"Address\", \"cep\", function (frm) { \n    if (!frm.doc.cep) \n    return; \nfrappe.call({ \n    method: 'ordem_servico.api.get_cep',\n    args: {\n\t   'cep': frm.doc.cep,\n    \t}, \n    callback: function(r) {\n        // code snippet\n\tdebugger;\n\tObject.keys(r.message).forEach(key => frm.set_value(key, r.message[key]));\n    } \n    }); \n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2023-02-15 08:08:57.307199",
  "module": null,
  "name": "Ocultar eventos em oportunidade CRM",
  "script": "frappe.ui.form.on(\"Opportunity\", {\n  refresh: function(frm) {\n    setTimeout(function() {\n      // código para esconder elementos na página\n      $('div.open-events.pl-1').hide();\n      $('#opportunity-activities_tab > div:nth-child(1) > div > div > form > div > div > div.new-btn.pb-3 > span > button.btn.btn-sm.small.new-event-btn').hide();\n      $('#opportunity-activities_tab > div:nth-child(1) > div > div > form > div.frappe-control.form-group > div').hide();\n      $(document).ajaxComplete(function() {\n        // código para esconder elementos na página\n        $('div.open-events.pl-1').hide();\n        $('#opportunity-activities_tab > div:nth-child(1) > div > div > form > div > div > div.new-btn.pb-3 > span > button.btn.btn-sm.small.new-event-btn').hide();\n        $('#opportunity-activities_tab > div:nth-child(1) > div > div > form > div.frappe-control.form-group > div').hide();\n      });\n    },50);\n  }\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2023-02-10 15:09:25.330246",
  "module": null,
  "name": "Realtime",
  "script": "frappe.realtime.on(\"doc_update\", data => {\n    if (data.doctype == cur_frm.doctype && data.name == cur_frm.docname) {\n        cur_frm.reload_doc();\n        console.log(\"Recarregando....\")\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2023-02-23 08:52:48.773311",
  "module": null,
  "name": "Validação cep e numero",
  "script": "frappe.ui.form.on('Quotation', {\n    validate: function(frm) {\n        console.log(\"validate\")\n        // Obter o link do endereço selecionado na cotação\n        var customer_address = frm.doc.customer_address;\n\n        if (!customer_address) {\n            return;\n        }\n\n        // Buscar o endereço correspondente\n        frappe.call({\n            method: \"frappe.client.get\",\n            args: {\n                doctype: \"Address\",\n                name: customer_address\n            },\n            callback: function(r) {\n                var endereco = r.message;\n\n                if (endereco && (!endereco.cep || !endereco.numero)) {\n                    frappe.msgprint({\n                        title: __('Endereço incompleto'),\n                        message: __('Por favor, preencha o CEP e o número do endereço antes de salvar.'),\n                        indicator: 'orange'\n                    });\n                    frappe.validated = false;\n                } else {\n                    frappe.validated = true;\n                }\n            }\n        });\n    }\n});\n\n// Adicionar um gatilho para verificar os campos novamente ao alterar o endereço\nfrappe.ui.form.on('Quotation', 'customer_address', function(frm) {\n    frm.trigger('validate');\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 1,
  "modified": "2023-03-08 16:38:33.478777",
  "module": null,
  "name": "Data Ordem Interna",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    onload: function(frm) {\n        if (!frm.doc.tempo_inicio_recebimento) {\n            const now = frappe.datetime.now_datetime();\n            const formatted_date = frappe.datetime.str_to_user(now).replace(\" \",\" \");\n            frm.set_value(\"tempo_inicio_recebimento\", formatted_date);\n            frm.set_df_property(\"tempo_inicio_recebimento\", \"read_only\", 1);\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 1,
  "modified": "2023-03-13 16:33:20.251859",
  "module": null,
  "name": "Definir obrigação nos campos de agendamento",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    refresh: function(frm) {\n    if (frm.doc.customer && frm.doc.contact_link && frm.doc.desc_item_nf && frm.doc.qtd_nf && frm.doc.cfop && frm.doc.ncm && frm.doc.serie_number && frm.doc.equipment_model && frm.doc.equipment_tag && frm.doc.equipment_description && frm.doc.tipo_servico != \"\")\n    frm.set_df_property('initial_scheduled_to', 'reqd', 1);\n    /*frm.set_df_property('quotation_schedule_date', 'reqd', 1);\n    frm.set_df_property('quotation_time', 'reqd', 1);*/\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 1,
  "modified": "2023-03-13 16:33:44.311274",
  "module": null,
  "name": "Incluir obrigação de Data de agendamento Ordem Serviço",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    refresh: function(frm) {\n    if (frm.doc.customer && frm.doc.contact_link && frm.doc.desc_item_nf && frm.doc.qtd_nf && frm.doc.cfop && frm.doc.ncm && frm.doc.serie_number && frm.doc.equipment_model && frm.doc.equipment_tag && frm.doc.equipment_description && frm.doc.tipo_servico != \"\")\n    /*frm.set_df_property('initial_scheduled_to', 'reqd', 1);*/\n    frm.set_df_property('quotation_schedule_date', 'reqd', 1);\n    /*frm.set_df_property('quotation_time', 'reqd', 1);*/\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 0,
  "modified": "2023-03-10 13:39:09.825025",
  "module": null,
  "name": "Incluir Obrigação de tempo de agendamento no Doctype Ordem de Serviço Interna",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    refresh: function(frm) {\n    if (frm.doc.customer && frm.doc.contact_link && frm.doc.nat_operacao && frm.doc.cfop && frm.doc.ncm && frm.doc.serie_number && frm.doc.equipment_model && frm.doc.equipment_tag && frm.doc.equipment_description && frm.doc.tipo_servico != \"\"){\n    frm.set_df_property('quotation_time', 'reqd', 1);\n    }\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 0,
  "modified": "2023-03-14 07:58:16.280366",
  "module": null,
  "name": "Status Ordem Serviço - Somente Leitura",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    refresh: function(frm) {\n    if (frm.doc.customer || frm.doc.contact_link || frm.doc.desc_item_nf || frm.doc.qtd_nf || frm.doc.cfop || frm.doc.ncm || frm.doc.serie_number || frm.doc.equipment_model || frm.doc.equipment_tag || frm.doc.equipment_description || frm.doc.tipo_servico == \"\"){\n    /*frm.set_df_property('initial_scheduled_to', 'reqd', 1);*/\n    frm.doc.status_order_service = \"Em Recebimento\"\n    frm.set_df_property('status_order_service', 'read_only', 1);\n    /*frm.set_df_property('quotation_time', 'reqd', 1);*/\n    }\n   \n}});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 0,
  "modified": "2023-03-14 07:53:00.843282",
  "module": null,
  "name": "Remover somente leitura status == \"Aguardando Orçamento\" Ordem Servico Interna",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n\trefresh(frm) {\n\tif(frm.doc.status_order_service == \"Aguardando Orçamento\"){\n    frm.set_df_property('status_order_service', 'read_only', 0);\n    \n    }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2023-06-26 14:18:55.233679",
  "module": null,
  "name": "Validação incluir cep em Endereço em Cliente",
  "script": "frappe.ui.form.on('Customer', {\n    validate: function(frm) {\n        console.log(\"validate\")\n        // Obter o link do endereço principal do cliente selecionado na cotação\n        var customer_primary_address = frm.doc.customer_primary_address;\n\n        if (!customer_primary_address) {\n            return;\n        }\n\n        // Buscar o endereço correspondente\n        frappe.call({\n            method: \"frappe.client.get\",\n            args: {\n                doctype: \"Address\",\n                name: customer_primary_address\n            },\n            callback: function(r) {\n                var endereco = r.message;\n\n                if (endereco && (!endereco.cep || !endereco.numero)) {\n                    frappe.msgprint({\n                        title: __('Endereço incompleto'),\n                        message: __('Por favor, preencha o CEP e o número no campo de \"Endereço Principal do Cliente\" antes de salvar.'),\n                        indicator: 'orange'\n                    });\n                    frappe.validated = false;\n                } else {\n                    frappe.validated = true;\n                }\n            }\n        });\n    }\n});\n\n// Adicionar um gatilho para verificar os campos novamente ao alterar o endereço\nfrappe.ui.form.on('Customer', 'customer_primary_address', function(frm) {\n    frm.trigger('validate');\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 0,
  "modified": "2023-07-20 09:21:49.894034",
  "module": null,
  "name": "Puxar itens do Orçamento para Ordem Servico Interna com base no link selecionado de orçamento",
  "script": "",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2023-07-24 09:36:43.845348",
  "module": null,
  "name": "Incluir máscara no RG e CPF no cadastro do Colaborador",
  "script": "frappe.ui.form.on('Employee', {\n   onload: function(frm) {\n        (async () => {\n            const response = await fetch(\"https://unpkg.com/imask\");\n            const scriptText = await response.text();\n            const script = document.createElement(\"script\");\n            script.text = scriptText;\n            document.head.appendChild(script);\n            const numeroDocumento = frm.fields_dict['cpf'].$input[0];\n            const numeroDocumentoRG = frm.fields_dict['cedula_de_identidade'].$input[0];\n            let mask = null;\n            numeroDocumento.setAttribute(\"maxlength\", 14);\n            mask = IMask(numeroDocumento, {\n                mask: '000.000.000-00'\n            });\n            numeroDocumentoRG.setAttribute(\"maxlength\", 12);\n            mask = IMask(numeroDocumentoRG, {\n                mask: '00.000.000-0'\n            });\n           \n        })();\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2023-07-25 11:24:46.386355",
  "module": null,
  "name": "incluindo Máscara nas informações de pix dentro de colaborador",
  "script": "frappe.ui.form.on('Employee', {\n   onload: function(frm) {\n        (async () => {\n            const response = await fetch(\"https://unpkg.com/imask\");\n            const scriptText = await response.text();\n            const script = document.createElement(\"script\");\n            script.text = scriptText;\n            document.head.appendChild(script);\n            const numeroDocumentoCPF_PIX = frm.fields_dict['cpf_pix'].$input[0];\n            const numeroDocumentoCNPJ_PIX = frm.fields_dict['cnpj_pix'].$input[0];\n            const numeroDocumentoCelular_PIX = frm.fields_dict['celular'].$input[0];\n            let mask = null;\n            numeroDocumentoCPF_PIX.setAttribute(\"maxlength\", 14);\n            mask = IMask(numeroDocumentoCPF_PIX, {\n                mask: '000.000.000-00'\n            });\n            numeroDocumentoCNPJ_PIX.setAttribute(\"maxlength\", 18);\n            mask = IMask(numeroDocumentoCNPJ_PIX, {\n                mask: '00.000.000/0000-00'\n            });\n            numeroDocumentoCelular_PIX.setAttribute(\"maxlength\", 15);\n            mask = IMask(numeroDocumentoCelular_PIX, {\n                mask: '(00) 00000-0000'\n            });\n           \n        })();\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2023-07-25 11:29:12.319551",
  "module": null,
  "name": "Ocultando e Desocultando valor de salário em colaborador",
  "script": "frappe.ui.form.on('Employee', {\n  onload: function(frm) {\n    const ctcInput = frm.get_field(\"ctc\").$input;\n    // Definir o valor do campo como '---'\n    ctcInput.val('---');\n  },\n  'visualizar': function(frm) {\n    const ctcInput = frm.get_field(\"ctc\").$input;\n    if (ctcInput.attr(\"type\") === \"text\") {\n      // Mostrar o valor original\n      ctcInput.val(frm.doc.ctc);\n      ctcInput.attr(\"type\", \"currency\");\n    } else {\n      // Ocultar o valor com '---'\n      ctcInput.val('---');\n      ctcInput.attr(\"type\", \"text\");\n    }\n  }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 1,
  "modified": "2023-08-03 14:05:11.659705",
  "module": null,
  "name": "Adicionando itens na tabela com base no link de orçamento",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n  has_quotation_link: function(frm) {\n    // Obter o valor do campo \"has_quotation_link\"\n    const quotation = frm.doc.has_quotation_link;\n\n    // Limpar a tabela se o campo \"has_quotation_link\" estiver vazio\n    if (!quotation) {\n      frm.clear_table('os_items');\n      frm.refresh_field('os_items');\n      return;\n    }\n\n    // Consultar a tabela de orçamento usando o valor do campo \"has_quotation_link\"\n    frappe.call({\n      method: 'frappe.client.get',\n      args: {\n        doctype: 'Quotation',\n        name: quotation,\n      },\n      callback: function(response) {\n        const quotation_doc = response.message;\n\n        // Limpar a tabela antes de adicionar novos itens\n        frm.clear_table('os_items');\n\n        // Iterar sobre os itens do orçamento e adicionar à tabela em Ordem Servico Interna\n        if (quotation_doc && quotation_doc.items) {\n          for (const item of quotation_doc.items) {\n            const row = frm.add_child('os_items');\n            row.item_code = item.item_code;\n            row.item_name = item.item_name;\n            row.item_qty = item.qty;\n            // Adicione outros campos necessários aqui\n          }\n          frm.refresh_field('os_items');\n        }\n      },\n    });\n  },\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 1,
  "modified": "2023-08-03 14:15:26.191917",
  "module": null,
  "name": "Manter editável campo de pontos de calibração em Ordem Servico Interna",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    onload: function(frm) {\n        // Defina a ação a ser executada quando o formulário é carregado\n        frm.add_fetch('has_quotation_link', 'pontos_de_calibracao', 'pontos_cal_criterios_aceitacao');\n\n        // Defina o campo como editável no carregamento\n        frm.set_df_property('pontos_cal_criterios_aceitacao', 'read_only', 0);\n    },\n    refresh: function(frm) {\n        // Defina a ação a ser executada quando o formulário é atualizado ou carregado\n        frm.set_df_property('pontos_cal_criterios_aceitacao', 'read_only', 0);\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2023-08-15 14:13:42.253894",
  "module": null,
  "name": "Validação pontos de calibração vazio em orçamento",
  "script": "frappe.ui.form.on('Quotation', {\n    validate: function(frm) {\n        console.log(\"validate\");\n\n        // Obter o valor do campo pontos_de_calibracao\n        let pontos_de_calibracao = frm.doc.pontos_de_calibracao;\n\n        // Verificar se o campo está vazio ou contém apenas formatação HTML\n        let htmlContent = $('<div class=\"ql-editor ql-blank\" data-gramm=\"false\" contenteditable=\"true\"><p><br></p></div>').html(pontos_de_calibracao).text();\n        \n        if (!htmlContent.trim() && !frm.doc.hash_orc) {\n            frappe.msgprint({\n                title: __('Campos vazios'),\n                message: __('O Campo de \"Pontos de calibração\" está vazio'),\n                indicator: 'red'\n            });\n            frappe.validated = false;\n        }\n        else{\n            frappe.validated = true;\n        }\n       \n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Bank Account",
  "enabled": 1,
  "modified": "2024-01-15 14:29:47.415260",
  "module": null,
  "name": "incluindo M\u00e1scara nas informa\u00e7\u00f5es de pix dentro de Conta Banc\u00e1ria",
  "script": "frappe.ui.form.on('Bank Account', {\n   onload: function(frm) {\n        (async () => {\n            const response = await fetch(\"https://unpkg.com/imask\");\n            const scriptText = await response.text();\n            const script = document.createElement(\"script\");\n            script.text = scriptText;\n            document.head.appendChild(script);\n            const numeroDocumentoCPF_PIX = frm.fields_dict['cpf_pix'].$input[0];\n            const numeroDocumentoCNPJ_PIX = frm.fields_dict['cnpj_pix'].$input[0];\n            const numeroDocumentoCelular_PIX = frm.fields_dict['celular'].$input[0];\n            let mask = null;\n            numeroDocumentoCPF_PIX.setAttribute(\"maxlength\", 14);\n            mask = IMask(numeroDocumentoCPF_PIX, {\n                mask: '000.000.000-00'\n            });\n            numeroDocumentoCNPJ_PIX.setAttribute(\"maxlength\", 18);\n            mask = IMask(numeroDocumentoCNPJ_PIX, {\n                mask: '00.000.000/0000-00'\n            });\n            numeroDocumentoCelular_PIX.setAttribute(\"maxlength\", 15);\n            mask = IMask(numeroDocumentoCelular_PIX, {\n                mask: '(00) 00000-0000'\n            });\n           \n        })();\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Bank Account",
  "enabled": 1,
  "modified": "2024-01-15 15:40:08.176652",
  "module": null,
  "name": "incluindo M\u00e1scara nas informa\u00e7\u00f5es de pix dentro de Conta Banc\u00e1ria",
  "script": "frappe.ui.form.on('Bank Account', {\n   onload: function(frm) {\n        (async () => {\n            const response = await fetch(\"https://unpkg.com/imask\");\n            const scriptText = await response.text();\n            const script = document.createElement(\"script\");\n            script.text = scriptText;\n            document.head.appendChild(script);\n            const numeroDocumentoCPF_PIX = frm.fields_dict['cpf_pix'].$input[0];\n            const numeroDocumentoCNPJ_PIX = frm.fields_dict['cnpj_pix'].$input[0];\n            const numeroDocumentoCelular_PIX = frm.fields_dict['celular'].$input[0];\n            let mask = null;\n            numeroDocumentoCPF_PIX.setAttribute(\"maxlength\", 14);\n            mask = IMask(numeroDocumentoCPF_PIX, {\n                mask: '000.000.000-00'\n            });\n            numeroDocumentoCNPJ_PIX.setAttribute(\"maxlength\", 18);\n            mask = IMask(numeroDocumentoCNPJ_PIX, {\n                mask: '00.000.000/0000-00'\n            });\n            numeroDocumentoCelular_PIX.setAttribute(\"maxlength\", 15);\n            mask = IMask(numeroDocumentoCelular_PIX, {\n                mask: '(00) 00000-0000'\n            });\n           \n        })();\n    }\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 0,
  "modified": "2023-10-25 14:57:40.994636",
  "module": null,
  "name": "Confirmação se campo for vazio",
  "script": "frappe.ui.form.on('Sales Order', {\n    \n     validate: async (frm) => {\n         if (frm.doc.tipo == \"\"|| frm.doc.confirmacao ==\"\") {\n         \n        let prompt = new Promise((resolve, reject) => {\n            \n            frappe.confirm(\n                'Are you sure?',\n                () => resolve(),\n                () => reject()\n            );\n        });\n        await prompt.then(\n            () => frappe.show_alert(\"Submitted\", 3), \n            () => {\n                frappe.validated = false;\n                frappe.show_alert(\"Not submitted\", 3)\n            }\n        );\n         }\n        \n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 1,
  "modified": "2024-06-28 13:09:02.746558",
  "module": null,
  "name": "Particularidades do cliente",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n    refresh: function(frm) {\n        update_headline(frm);\n    },\n    status_order_service: function(frm) {\n        update_headline(frm);\n    },\n    customer: function(frm) {\n        update_headline(frm);\n    }\n});\n\nfunction update_headline(frm) {\n    // Variável para armazenar a nova mensagem\n    let new_headline = '';\n\n    if (frm.doc.status_order_service) {\n        if (frm.doc.customer) {\n            frappe.call({\n                method: 'frappe.client.get',\n                args: {\n                    doctype: 'Customer',\n                    name: frm.doc.customer\n                },\n                callback: function(r) {\n                    if (r.message && r.message.customer_details) {\n                        new_headline = 'Detalhes do cliente: ' + r.message.customer_details;\n                    } else {\n                        new_headline = 'Sem observações referentes às particularidades do cliente.';\n                    }\n\n                    // Limpa e define o novo aviso se ele for diferente do atual\n                    if (frm.dashboard.headline !== new_headline) {\n                        frm.dashboard.clear_headline();\n                        frm.dashboard.set_headline(new_headline);\n                    }\n                }\n            });\n        } else {\n            new_headline = 'Sem observações referentes às particularidades do cliente.';\n            \n            // Limpa e define o novo aviso se ele for diferente do atual\n            if (frm.dashboard.headline !== new_headline) {\n                frm.dashboard.clear_headline();\n                frm.dashboard.set_headline(new_headline);\n            }\n        }\n    } else {\n        frm.dashboard.clear_headline();\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2024-07-08 14:36:15.376652",
  "module": null,
  "name": "Particularidades do cliente Quotation",
  "script": "frappe.ui.form.on('Quotation', {\n    refresh: function(frm) {\n        update_headline(frm);\n    },\n    status_order_service: function(frm) {\n        update_headline(frm);\n    },\n    customer: function(frm) {\n        update_headline(frm);\n    }\n});\n\nfunction update_headline(frm) {\n    // Variável para armazenar a nova mensagem\n    let new_headline = '';\n\n    if (frm.doc.status) {\n        if (frm.doc.party_name) {\n            frappe.call({\n                method: 'frappe.client.get',\n                args: {\n                    doctype: 'Customer',\n                    name: frm.doc.party_name\n                },\n                callback: function(r) {\n                    if (r.message && r.message.customer_details) {\n                        new_headline = 'Detalhes do cliente: ' + r.message.customer_details;\n                    } else {\n                        new_headline = 'Sem observações referentes às particularidades do cliente.';\n                    }\n\n                    // Limpa e define o novo aviso se ele for diferente do atual\n                    if (frm.dashboard.headline !== new_headline) {\n                        frm.dashboard.clear_headline();\n                        frm.dashboard.set_headline(new_headline);\n                    }\n                }\n            });\n        } else {\n            new_headline = 'Sem observações referentes às particularidades do cliente.';\n            \n            // Limpa e define o novo aviso se ele for diferente do atual\n            if (frm.dashboard.headline !== new_headline) {\n                frm.dashboard.clear_headline();\n                frm.dashboard.set_headline(new_headline);\n            }\n        }\n    } else {\n        frm.dashboard.clear_headline();\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2024-07-08 14:42:04.375006",
  "module": null,
  "name": "Particularidades do cliente Pedido Vendas",
  "script": "frappe.ui.form.on('Sales Order', {\n    refresh: function(frm) {\n        update_headline(frm);\n    },\n    status_order_service: function(frm) {\n        update_headline(frm);\n    },\n    customer: function(frm) {\n        update_headline(frm);\n    }\n});\n\nfunction update_headline(frm) {\n    // Variável para armazenar a nova mensagem\n    let new_headline = '';\n\n    if (frm.doc.status) {\n        if (frm.doc.customer) {\n            frappe.call({\n                method: 'frappe.client.get',\n                args: {\n                    doctype: 'Customer',\n                    name: frm.doc.customer\n                },\n                callback: function(r) {\n                    if (r.message && r.message.customer_details) {\n                        new_headline = 'Detalhes do cliente: ' + r.message.customer_details;\n                    } else {\n                        new_headline = 'Sem observações referentes às particularidades do cliente.';\n                    }\n\n                    // Limpa e define o novo aviso se ele for diferente do atual\n                    if (frm.dashboard.headline !== new_headline) {\n                        frm.dashboard.clear_headline();\n                        frm.dashboard.set_headline(new_headline);\n                    }\n                }\n            });\n        } else {\n            new_headline = 'Sem observações referentes às particularidades do cliente.';\n            \n            // Limpa e define o novo aviso se ele for diferente do atual\n            if (frm.dashboard.headline !== new_headline) {\n                frm.dashboard.clear_headline();\n                frm.dashboard.set_headline(new_headline);\n            }\n        }\n    } else {\n        frm.dashboard.clear_headline();\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 0,
  "modified": "2024-07-22 14:08:32.928396",
  "module": null,
  "name": "Bot\u00e3o Gerar Formul\u00e1rio de Visita",
  "script": "frappe.listview_settings['Ordem Servico Interna'] = {\n    onload: function(listview) {\n        listview.page.add_inner_button(__('Imprimir Formul\u00e1rio de Visita'), function() {\n            let selected_docs = listview.get_checked_items();\n            if (selected_docs.length > 0) {\n                let docnames = selected_docs.map(doc => doc.name);\n\n                frappe.call({\n                    method: 'frappe.utils.print_format.download_multi_pdf',\n                    args: {\n                        doctype: 'Ordem Servico Interna',\n                        docnames: JSON.stringify(docnames),\n                        format: 'Formulario de Visita',\n                        no_letterhead: 0\n                    },\n                    callback: function(response) {\n                        if (response) {\n                            let blob = new Blob([response], { type: 'application/pdf' });\n                            let link = document.createElement('a');\n                            link.href = window.URL.createObjectURL(blob);\n                            link.download = 'formulario_de_visita.pdf';\n                            link.click();\n                        } else {\n                            frappe.msgprint(__('Erro ao gerar o PDF.'));\n                        }\n                    }\n                });\n            } else {\n                frappe.msgprint(__('Por favor, selecione pelo menos uma Ordem de Servi\u00e7o.'));\n            }\n        });\n    }\n};\n",
  "view": "List"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Interna",
  "enabled": 0,
  "modified": "2024-07-11 15:34:25.536262",
  "module": null,
  "name": "Limpar numero de serie ao inserir cliente na os",
  "script": "frappe.ui.form.on('Ordem Servico Interna', {\n\t\n\tcustomer: function(frm) {\n        frm.set_value('serie_number', ''); // Limpa o campo de equipamento\n    }\n\t\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Ordem Servico Externa",
  "enabled": 0,
  "modified": "2024-07-11 15:34:19.223691",
  "module": null,
  "name": "Limpar numero de serie ao inserir cliente na os externa",
  "script": "frappe.ui.form.on('Ordem Servico Externa', {\n    \n    customer: function(frm) {\n        frm.set_value('serie_number', ''); // Limpa o campo de equipamento\n    }\n    \n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2024-07-11 15:39:44.008229",
  "module": null,
  "name": "Filtrar contatos da tabela de credito de clientes em clientes",
  "script": "frappe.ui.form.on('Customer', {\n    refresh: function(frm) {\n        // Filtro para o campo 'contato' na tabela 'credito_cliente'\n        frm.fields_dict['credito_cliente'].grid.get_field('contato').get_query = function(doc) {\n            return {\n                filters: {\n                    'link_doctype': 'Customer',\n                    'link_name': doc.name\n                }\n            };\n        };\n\n        // Filtro para o campo 'sales_order' na tabela 'credito_cliente'\n        frm.fields_dict['credito_cliente'].grid.get_field('sales_order').get_query = function(doc) {\n            return {\n                filters: {\n                    'customer': doc.name\n                }\n            };\n        };\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 0,
  "modified": "2024-08-08 09:28:54.241725",
  "module": null,
  "name": "Filtrar condicoes em orcamento com base em na empresa",
  "script": "frappe.ui.form.on('Quotation', {\n    onload: function(frm) {\n        \n        if (frm.doc.company === 'ER Metrologia') {\n            frm.fields_dict.tc_name.get_query = function() {\n                return {\n                    filters: {\n                        'name': ['in', ['CARTÃO CORPORATIVO', 'CARTÃO DE CRÉDITO', 'DEPÓSITO', 'TRANSFERÊNCIA BANCÁRIA']]\n                    }\n                };\n            };\n        }\n    },\n    company: function(frm) {\n        if (frm.doc.company === 'ER Metrologia') {\n            frm.fields_dict.tc_name.get_query = function() {\n                return {\n                    filters: {\n                        'name': ['in', ['CARTÃO CORPORATIVO', 'CARTÃO DE CRÉDITO', 'DEPÓSITO', 'TRANSFERÊNCIA BANCÁRIA']]\n                    }\n                };\n            };\n        } else {\n            frm.fields_dict.tc_name.get_query = function() {\n                return {\n                    filters: {}\n                };\n            };\n        }\n    }\n\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2024-07-26 08:35:14.126789",
  "module": null,
  "name": "party_name_check",
  "script": "frappe.ui.form.on('Quotation', {\n    party_name: function(frm) {\n        if (frm.doc.party_name) {\n            frappe.db.get_value('Customer', frm.doc.party_name, 'company', (r) => {\n                if (r.company) {\n                    frm.set_value('company', r.company);\n                } else {\n                    // Não faz nada, mantendo o valor atual\n                    frm.refresh_field('company');\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2024-08-29 09:52:01.787766",
  "module": null,
  "name": "Verificacao analise critica cliente",
  "script": "frappe.ui.form.on('Sales Order', {\n\n    customer: function(frm) {\n        update_headline(frm);\n    }\n});\n\nfunction update_headline(frm) {\n    // Verifica se o status do documento é \"Rascunho\" (docstatus = 0)\n    if (frm.doc.docstatus === 0) {\n        // Obtém o nome do usuário logado\n        let current_user = frappe.session.user;\n\n        // Obtém o nome completo do usuário a partir do doctype 'User'\n        frappe.call({\n            method: 'frappe.client.get_value',\n            args: {\n                doctype: 'User',\n                fieldname: 'full_name',\n                filters: {\n                    name: current_user\n                }\n            },\n            callback: function(user) {\n                let user_name = user.message.full_name;\n\n                if (frm.doc.customer) {\n                    frappe.call({\n                        method: 'frappe.client.get_value',\n                        args: {\n                            doctype: 'Customer',\n                            fieldname: ['data_limite_de_faturamento', 'tipo_de_faturamento', 'faturamento_parcial', 'confirmacao_do_cliente', 'tipo', 'confirmacao'],\n                            filters: {\n                                name: frm.doc.customer\n                            }\n                        },\n                        callback: function(r) {\n                            if (r.message) {\n                                // Armazenando os valores retornados\n                                let data_limite = r.message.data_limite_de_faturamento;\n                                let tipo_faturamento = r.message.tipo_de_faturamento;\n                                let faturamento_parcial = r.message.faturamento_parcial;\n                                let confirmacao_cliente = r.message.confirmacao_do_cliente;\n                                let tipo = r.message.tipo;\n                                let confirmacao = r.message.confirmacao;\n\n                                // Verifica se algum dos campos está preenchido\n                                if (data_limite || tipo_faturamento || faturamento_parcial || confirmacao_cliente || tipo || confirmacao) {\n                                    // Mensagem personalizada e formal\n                                    let mensagem = `${user_name}, o cliente selecionado possui as seguintes informações cadastradas na Análise Crítica:<br>`;\n                                    if (data_limite) mensagem += `<b>- Data Limite de Faturamento: ${data_limite}</b><br>`;\n                                    if (tipo_faturamento) mensagem += `<b>- Tipo de Faturamento: ${tipo_faturamento}</b><br>`;\n                                    if (faturamento_parcial) mensagem += `<b>- Faturamento Parcial: ${faturamento_parcial}</b><br>`;\n                                    if (confirmacao_cliente) mensagem += `<b>- Confirmação do Cliente: ${confirmacao_cliente}</b><br>`;\n                                    if (tipo) mensagem += `<b>- Tipo: ${tipo}</b><br>`;\n                                    if (confirmacao) mensagem += `<b>- Confirmação: ${confirmacao}</b><br>`;\n\n                                    mensagem += \"Se desejar que essas informações sejam automaticamente preenchidas na Análise Crítica deste pedido, basta salvar o documento. Caso contrário, você pode preencher os dados manualmente conforme a necessidade.\";\n\n                                    // Limpa mensagens anteriores no dashboard\n                                    frm.dashboard.clear_headline();\n\n                                    // Exibe a mensagem no dashboard com uma das cores predefinidas\n                                    frm.dashboard.set_headline_alert(mensagem, 'green');  // Pode ser 'green', 'red', 'orange', 'yellow', ou 'grey'\n                                }\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-05-23 09:43:43.830761",
  "module": "Ordem Servico",
  "name": "Refresh Selling Price List",
  "script": "frappe.ui.form.on('Quotation', {\n    onload_post_render(frm) {\n        if (frm.doc.selling_price_list) {\n            const lista_original = frm.doc.selling_price_list;\n\n            frm.set_value('selling_price_list', '');\n\n            setTimeout(() => {\n                frm.set_value('selling_price_list', lista_original);\n            }, 300);\n        }\n    }\n});\n",
  "view": "Form"
 }
]
